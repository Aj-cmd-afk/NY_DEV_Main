imports:
  Text: Data.Text
  UTCTime: Kernel.Prelude
  BaseUrl: Kernel.Prelude
  MonadThrow: T1
  MonadTime: T2
  Log: T3
  BecknSearchReq: T4
  DomainSearchReq: T5

module: Search
types:
  SearchReq:
    context: Context
    message: SearchMessage

  Context:
    action: ContextAction
    messageId: Text
    transactionId: Text
    bapId: Text
    bapUri: BaseUrl
    loction: ContextLocation
    bapCity: Text
    bapCountry: Text

  ContextAction:
    enum: "search,on_search"

  ContextLocation:
    city: Descriptor
    country: Descriptor

  Descriptor:
    code: Text

  SearchMessage:
    intent: SearchIntent

  SearchIntent:
    fulfillment: SearchFulfillment

  SearchFulfillment:
    stops: [FulfillmentStop]

  FulfillmentStop:
    location: Location

  Location:
    gps: Text

  DSearchReq:
    messageId: Text
    transactionId: Text
    bapId: Text
    bapUri: BaseUrl
    bapCity: Text
    bapCountry: Text
    customerPhoneNum: Maybe Text
    pickupLocation: LatLong
    pickupTime: UTCTime
    dropLocation: LatLong
    pickupAddress: Maybe Address
    dropAddrress: Maybe Address
    routeDistance: Maybe Meters
    routeDuration: Maybe Seconds
    device: Maybe Text
    disabilityTag: Maybe Text
    routePoints: Maybe [LatLong]

  Address:
    city: Text
    area: Text

  LatLong:
    lat: Double
    lon: Double

  Meters:
    getMeters: Int

  Seconds:
    getSeconds: Int

transformer:
  monads:
    - MonadThrow m
    - MonadTime m
    - Log m
  transformers:
    buildBecknSearchReq:
      # extraMonads: should we allow this
      fromTypes:
        - DomainSearchReq
        - Context
      paramNames:
        - domainSearchReq
        - context
      toType: BecknSearchReq
      mapping:
        searchReqContext: context
        searchReqMessage: ?

  # $  -> pure    Haskell functions
  # $$ -> impure  Haskell functions
