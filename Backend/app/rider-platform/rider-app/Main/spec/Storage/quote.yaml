imports:
  Merchant: Domain.Types.Merchant
  MerchantOperatingCity: Domain.Types.MerchantOperatingCity
  Price: Kernel.Types.Common
  BaseUrl: Kernel.Types.Common
  VehicleServiceTierType: Domain.Types.VehicleServiceTier
  SpecialZoneQuote: Domain.Types.SpecialZoneQuote
  RentalDetails: Domain.Types.RentalDetails
  DriverOffer: Domain.Types.DriverOffer
  RentalDetailsAPIEntity: Domain.Types.RentalDetails
  DriverOfferAPIEntity: Domain.Types.DriverOffer
  InterCityQuoteAPIEntity: Domain.Action.UI.SpecialZoneQuote
  SpecialZoneQuoteAPIEntity: Domain.Action.UI.SpecialZoneQuote
  parseBaseUrl: Kernel.Prelude
  TripTerms: Domain.Types.TripTerms
  SearchRequest: Domain.Types.SearchRequest
  FareProductType: Domain.Types.FarePolicy.FareProductType
  Currency: Kernel.Types.Common
  showBaseUrl: Kernel.Prelude
  Distance: Kernel.Types.Common


Quote:
  dataName: quote


  types:
    QuoteDetails:
      enum: OneWayDetails OneWayQuoteDetails, InterCityDetails SpecialZoneQuote, RentalDetails RentalDetails, DriverOfferDetails DriverOffer, OneWaySpecialZoneDetails SpecialZoneQuote
      derive': Generic,Show

    OneWayQuoteDetails:
      distanceToNearestDriver: Distance
      derive': Generic,Show

    QuoteAPIDetails:
      enum: OneWayAPIDetails OneWayQuoteAPIDetails, InterCityAPIDetails InterCityQuoteAPIEntity, RentalAPIDetails RentalDetailsAPIEntity, DriverOfferAPIDetails DriverOfferAPIEntity, OneWaySpecialZoneAPIDetails SpecialZoneQuoteAPIEntity
      derive': Generic,Show

    OneWayQuoteAPIDetails:
      distanceToNearestDriver: HighPrecMeters
      distanceToNearestDriverWithUnit: Distance

    OneWaySpecialZoneQuoteAPIDetails:
      distanceToNearestDriver: HighPrecMeters
      quoteId: Text


  fields:
    id : Id Quote
    requestId : Id SearchRequest
    estimatedFare : Price
    discount : Maybe Price
    estimatedTotalFare : Price
    providerId : Text
    providerUrl : BaseUrl
    itemId : Text
    tripTerms : Maybe TripTerms
    quoteDetails : QuoteDetails
    merchantId : Id Merchant
    vehicleServiceTierType : VehicleServiceTierType
    serviceTierName: Maybe Text
    serviceTierShortDesc: Maybe Text
    merchantOperatingCityId : Id MerchantOperatingCity
    specialLocationTag : Maybe Text
    createdAt : UTCTime
    updatedAt: UTCTime
    validTill : UTCTime
  derives: "Generic, Show"

  beamFields:
      quoteDetails: {}
      tripTerms:
        tripTermsId: Maybe Text
      discount:
        discount: Maybe HighPrecMoney
        currency: Maybe Currency
        fareProductType: FareProductType
        distanceToNearestDriver: Maybe HighPrecMeters
        distanceUnit: Maybe Kernel.Types.Common.DistanceUnit
        distanceToNearestDriverValue: Maybe HighPrecDistance
        rentalDetailsId: Maybe Text
        driverOfferId: Maybe Text
        specialZoneQuoteId: Maybe Text

  beamType:
    estimatedFare : HighPrecMoney
    estimatedTotalFare: HighPrecMoney
    providerUrl: Text
    merchantOperatingCityId: Maybe Text
    updatedAt: Maybe UTCTime


  fromTType:
    updatedAt: Kernel.Prelude.fromMaybe createdAt|I
    providerUrl: parseBaseUrl|MI
    tripTerms: getTripTerms|M
    quoteDetails: Storage.Queries.Transformers.Quote.getQuoteDetails fareProductType distanceToNearestDriver rentalDetailsId driverOfferId specialZoneQuoteId distanceUnit distanceToNearestDriverValue|EM
    discount: Kernel.Types.Common.mkPrice currency <$> discount|E
    merchantOperatingCityId: backfillMOCId merchantOperatingCityId merchantId|EM
    estimatedFare: Kernel.Types.Common.mkPrice currency estimatedFare|E
    estimatedTotalFare: Kernel.Types.Common.mkPrice currency estimatedTotalFare|E

  toTType:
    updatedAt: (Kernel.Prelude.Just)|I
    fareProductType: (Storage.Queries.Transformers.Quote.getfareProduct (Storage.Queries.Transformers.Quote.getQuoteDetails' quoteDetails))|E
    discount: (discount <&> (.amount))|E
    currency: (Just ((.currency) estimatedFare))|E
    estimatedFare: ((.amount) estimatedFare)|E
    estimatedTotalFare: ((.amount) estimatedTotalFare)|E
    tripTermsId: (Kernel.Types.Id.getId <$> (tripTerms <&> (.id)))|E
    merchantOperatingCityId: (Just $ Kernel.Types.Id.getId merchantOperatingCityId)|E
    distanceToNearestDriver: (Kernel.Types.Common.distanceToHighPrecMeters <$> (Storage.Queries.Transformers.Quote.getDistanceToNearestDriver (Storage.Queries.Transformers.Quote.getQuoteDetails' quoteDetails)))|E
    distanceToNearestDriverValue: (Kernel.Types.Common.distanceToHighPrecDistance (Storage.Queries.Transformers.Quote.getDistanceToNearestDriver (Storage.Queries.Transformers.Quote.getQuoteDetails' quoteDetails) <&> (.unit)) <$> (Storage.Queries.Transformers.Quote.getDistanceToNearestDriver (Storage.Queries.Transformers.Quote.getQuoteDetails' quoteDetails)))|E
    distanceUnit: ((Storage.Queries.Transformers.Quote.getDistanceToNearestDriver (Storage.Queries.Transformers.Quote.getQuoteDetails' quoteDetails)) <&> (.unit))|E
    rentalDetailsId: (Storage.Queries.Transformers.Quote.getRentalDetailsId (Storage.Queries.Transformers.Quote.getQuoteDetails' quoteDetails))|E
    driverOfferId: (Storage.Queries.Transformers.Quote.getDriverOfferId (Storage.Queries.Transformers.Quote.getQuoteDetails' quoteDetails))|E
    specialZoneQuoteId: (Storage.Queries.Transformers.Quote.getSpecialZoneQuoteId (Storage.Queries.Transformers.Quote.getQuoteDetails' quoteDetails))|E
    providerUrl: showBaseUrl|I

  constraints:
    id: PrimaryKey
    requestId: SecondaryKey
    driverOfferId: SecondaryKey

  queries:
    findById:
      kvFunction: findOneWithKV
      where: id

    findAllBySRId:
      kvFunction: findAllWithKV
      where: requestId

  extraOperations:
    - EXTRA_QUERY_FILE

  excludedDefaultQueries:
    - create
    - createMany